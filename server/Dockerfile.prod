FROM node:20-alpine as build

RUN corepack enable
WORKDIR /dash
COPY . .
RUN yarn install
COPY . . 
WORKDIR /dash/server
# COPY ./server/package*.json ./
# RUN yarn workspaces focus -A
# COPY ./server .
# RUN ls -la /dash/ && echo "ls 3 /dash/"
RUN yarn build
COPY ./server/dist ./dist

WORKDIR /dash/client
RUN yarn build
COPY ./client/dist ../server/dist/public

USER node
ENV PORT=5000
EXPOSE 5000

WORKDIR /dash/server